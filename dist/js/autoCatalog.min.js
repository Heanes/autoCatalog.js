/*
 * autoCatalog - v1.0.0 - 2018-10-06 16:03:16 Saturday
 * https://github.com/heanes/autoCatalog.js
 * Copyright (c) 2018 Heanes
 * Licensed MIT License
 */

"use strict";!function(I,L,t,s){var i="autoCatalog",e={outlineSelector:["h2","h3","h4"],catalogContainer:s,autoCounter:!1,showChapterNumber:!0,showChapterSymbol:!0,formatChapterAnchor:s,changeUrlAnchor:!0,scrollContentAnimationDelay:400,scrollToContentOffset:0,scrollCatalogAnimationDelay:400,clickToScrollCatalogStep:48,alwaysShow:!0,collapseOnInit:!1,dataChapterFieldName:"data-chapter",onChapterClick:s,treeOption:{option:{data:[],getDataUrl:"",nodeIcon:"fa fa-list",iconCollapse:"",iconExpand:"",iconEmpty:"icon-empty",showCollapseExpandIcon:!1,showIcon:!1,nodeDefaultState:{selected:!1,expanded:!0,disabled:!1,checked:!1},afterRenderNode:function(t,e){},enableLink:!0,showSingleNodeIcon:!0},node:{text:"",nodeIcon:"fa fa-list",href:"",iconSelected:"",selectable:!0,state:{selected:!1,expanded:!0,disabled:!1,checked:!1},switchToShow:!0,target:"",nodes:[]}}},l=function(t,e){return this._defaults=this.getDefaults(),this.options=null,this.$element=null,this.inState=null,this.init(t,e),{options:this.options,init:I.proxy(this.init,this),destroy:I.proxy(this.destroy,this),refreshOption:I.proxy(this.refreshOption,this),show:I.proxy(this.show,this),hide:I.proxy(this.hide,this),toggle:I.proxy(this.toggle,this)}};function r(t){L.console&&L.console.error(t)}l.V=l.VERSION="1.0.0",l.DEFAULTS=e,l.prototype.init=function(t,e){return this.$element=I(t),this.$el_=this.$element.clone(!0),this.options=this.getOptions(e),this.treeData=this.getChapterTreeData(),this.renderCatalog(this.treeData),this.bindEvent(),this},l.prototype.bindEvent=function(){var t=this.$element,e=this.$catalog,i=this.options,a=t.position(),n=t.height(),l=this,o=e.find(".catalog-list-wrap"),s=e.find(".catalog-list"),r=e.find(".node-wrap"),d=r.eq(0).height(),p=e.find(".scrollbar-location-arrow"),c=p.height(),h=this.$outlines,f=h.length,u=o.height(),g=s.height()-u,v=e.find(".go-up-btn"),m=e.find(".go-down-btn"),C=i.clickToScrollCatalogStep,b=i.scrollCatalogAnimationDelay,y=i.scrollContentAnimationDelay,w=0,T=0,x=void 0,S=void 0,A=void 0,N=void 0,O=0;I(L).on("scroll",function(){O=I(this).scrollTop();for(var t=f-1;0<t;t--){if(x=h.eq(t),O>=x.offset().top-d)return N=x.attr(i.dataChapterFieldName),S=s.find("["+i.dataChapterFieldName+'="'+N+'"]'),A=S.position(),r.removeClass("active"),S.addClass("active"),0<g&&(A.top+d<=u?(w=0,v.addClass("disabled"),m.removeClass("disabled")):A.top+d>u&&A.top<g?(w=-A.top+u/2-d,v.removeClass("disabled"),m.removeClass("disabled")):A.top>g&&(w=-g,v.removeClass("disabled"),m.addClass("disabled")),0<b?s.stop().animate({top:w},b):s.css({top:w})),T=A.top+(S.height()-c)/2,0<b?p.stop().animate({top:T},b):p.css({top:T}),!1;T=(d-c)/2,0<b?p.stop().animate({top:T},b):p.css({top:T}),r.removeClass("active").eq(0).addClass("active")}i.alwaysShow||(O>=a.top+n?e.animate({opacity:0,visibility:"hidden"},1e3):e.animate({opacity:1,visibility:"visible"},1e3))}),(!i.changeUrlAnchor||0<i.scrollToContentOffset)&&e.on("click",function(t){var e=I("html,body"),a=I(t.target),n=a.hasClass("node-wrap")?a:a.closest(".node-wrap");if(i.changeUrlAnchor)L.location.href=L.location.href.split("#")[0]+n.attr("href");else{var o=n.attr(i.dataChapterFieldName),s=l.$element.find("["+i.dataChapterFieldName+'="'+o+'"]');0<y?e.animate({scrollTop:s.offset().top+i.scrollToContentOffset},y):e.scrollTop(s.offset().top+i.scrollToContentOffset)}return!1}),v.on("click",function(){var t=I(this);return t.hasClass("disabled")||(Math.abs(parseInt(s.css("top")))>=C?(s.stop().animate({top:"+="+C},"fast"),m.removeClass("disabled")):(s.stop().animate({top:"0"},"fast"),t.addClass("disabled"))),!1}),m.on("click",function(){var t=I(this);return t.hasClass("disabled")||(g-Math.abs(parseInt(s.css("top")))>=C?(e.find(".catalog-list").stop().animate({top:"-="+C},"fast"),v.removeClass("disabled")):(s.stop().animate({top:-g},"fast"),t.addClass("disabled"))),!1});var $=e.find(".go-top-btn"),D=e.find(".toggle-show-btn");return $.on("click",function(){I("html,body").animate({scrollTop:a.top},"fast")}),D.on("click",function(){l.$catalog.toggleClass("collapse")}),I(L).trigger("scroll"),this},l.prototype.getChapterTreeData=function(t){var e=t||this.$element,i=this.options,l=i.outlineSelector,a=l.join(","),n=e.find(a);this.$outlines=n;var r=[],d=this;return I.each(n,function(t,e){var a=I(e),n={nodes:[]};n.text=a.text();var o=d.matchOutlineSelectorLevel(a,l);if(1===(n.level=o))n.outline=[r.length+1],n.href="#"+d.formatChapterAnchor(n),r.push(n);else{var s=d.getParentNodeByLevel(r,o);n.outline=s.outline,n.href="#"+d.formatChapterAnchor(n),s.parentNode.nodes.push(n)}d.insertChapterAnchorToContent(a,n),a.attr(i.dataChapterFieldName,n.outline.join("."))}),r},l.prototype.getParentNodeByLevel=function(t,e){if(1===e)return t;var a=t[t.length-1],n=[];if(2===e)return{parentNode:a,outline:n=[t.length,a.nodes.length+1]};n=[t.length,a.nodes.length];for(var o=2;o<e;o++){var s=a.nodes;a=s[1<s.length?s.length-1:0],n.push(a.nodes.length+1)}return{parentNode:a,outline:n}},l.prototype.formatChapterAnchor=function(t,e){var a=this.options.formatChapterAnchor;return"function"==typeof a?a(t):(e=e||".",t.outline.join(e)+e+t.text)},l.prototype.matchOutlineSelectorLevel=function(a,t){var e=this.options;t=t||e.outlineSelector;var n=1;return I.each(t,function(t,e){if(a.hasClass(e)||a[0].tagName.toLowerCase()===e.toLowerCase())return n=t+1,!1}),n},l.prototype.insertChapterAnchorToContent=function(t,e){var a=this.generateOutlineAnchor(e);return t.before(a),this},l.prototype.generateOutlineAnchor=function(t){return'<div class="auto-catalog-outline-anchor">\n            <a class="auto-catalog-anchor-href" name="'+this.formatChapterAnchor(t)+'"></a>\n        </div>'},l.prototype.renderCatalog=function(t){var e=this.options;this.$catalog=I(this.template.main);var a=e.catalogContainer;!e.catalogContainer instanceof jQuery&&(a=I(e.catalogContainer));var n=this.$catalog.find(".catalog-list");return a.empty().append(this.$catalog),this.convertToStandardTree(t),n.append(this.buildTree(t)),e.collapseOnInit&&this.$catalog.addClass("collapse"),this.$catalog.find(".catalog-list-wrap").height()>=this.$catalog.find(".catalog-list").height()&&this.$catalog.find(".catalog-scrollbar-right").hide(),this},l.prototype.template={main:'<div class="auto-catalog">\n            <div class="catalog-wrap">\n                <div class="catalog-scrollbar-left">\n                    <em class="circle start"></em>\n                    <em class="circle end"></em>\n                </div>\n                <div class="catalog-list-wrap">\n                    <div class="catalog-list tree-list">\n                        <div class="scrollbar-location-arrow">\n                            <i class="rectangle"></i>\n                            <i class="triangle-right"></i>\n                        </div>\n                    </div>\n                </div>\n                <div class="catalog-scrollbar-right">\n                    <a class="handle-btn go-up-btn disabled" href="javascript:;"><i class="triangle-up"></i></a>\n                    <a class="handle-btn go-down-btn" href="javascript:;"><i class="triangle-down"></i></a>\n                </div>\n            </div>\n            <div class="catalog-toolbar-wrap">\n                <div class="catalog-toolbar">\n                    <a class="handle-btn toggle-show-btn" href="javascript:;"><i class="fa fa-list"></i></a>\n                    <a class="handle-btn go-top-btn" href="javascript:;"><i class="fa fa-angle-up"></i></a>\n                </div>\n            </div>\n        </div>',chapterSymbol:'<em class="chapter-symbol"></em>'},l.prototype.buildTree=function(t,l,e){if(t){var r=this.options,d=this.options.treeOption.option;l=l===s?d.overHeightSwitch?0:1:l;var p=this,c=I(p.treeTemplate.treeListGroup);return I.each(t,function(t,e){for(var a=I(p.treeTemplate.node).attr("data-nodeId",e.nodeId),n=I(p.treeTemplate.nodeWrap),o=0;o<l-1;o++)n.append(p.treeTemplate.indent);r.showChapterSymbol&&n.append('<em class="chapter-symbol"></em>');var s=[];if(e.nodes&&0<e.nodes.length?(s.push("node-collapse-expand-icon"),e.state.expanded?(s.push("expand"),s.push(d.iconExpand),a.addClass("expand")):(s.push("collapse"),s.push(d.iconCollapse),a.addClass("collapse"))):s.push(d.iconEmpty),d.showCollapseExpandIcon&&n.append(I(p.treeTemplate.icon).addClass(s.join(" "))),d.showIcon&&(1===l||d.showSingleNodeIcon||e.nodes&&0<e.nodes.length)){var i=["node-icon"];i.push(e.nodeIcon||d.nodeIcon),n.append(I(p.treeTemplate.icon).addClass(i.join(" ")))}if(r.showChapterNumber&&n.addClass("chapter-item").append('<span class="chapter-number">'+e.outline.join(".")+".</span>"),n.append(I(p.treeTemplate.nodeText).append(e.text).addClass("chapter-text")),n.attr(r.dataChapterFieldName,e.outline.join(".")),c.append(a.append(n)),d.afterRenderNode&&"function"==typeof d.afterRenderNode&&d.afterRenderNode(a,l),a.addClass("level"+l),e.nodes&&0<e.nodes.length&&a.append(p.buildTree(e.nodes,l+1)),1===l)return c}),c}},l.prototype.convertToStandardTree=function(a){if(a){var n=this.options,o=n.treeOption.node,s=this;return I.each(a,function(t,e){e.state=I.extend(!0,{},o.state,n.nodeDefaultState,e.state),a[t]=I.extend(!0,{},o,e),e.nodes&&0<e.nodes.length&&(a[t].nodes=s.convertToStandardTree(e.nodes))}),a}},l.prototype.treeTemplate={treeTopWrap:'<div class="tree-top-wrap"></div>',treeTop:'<ul class="tree-top-list"></ul>',treeListWrap:'<div class="tree-list-wrap"></div>',treeList:'<div class="tree-list"></div>',treeListGroupWrap:'<div class="tree-group-wrap"></div>',treeListGroup:'<ul class="tree-group"></ul>',nodeWrap:'<span class="node-wrap"></span>',nodeLink:'<a class="node-wrap"></a>',node:'<li class="tree-node"></li>',link:'<a href="javascript:;" class="node-wrap"></a>',nodeText:'<span class="node-text"></span>',indent:'<span class="indent"></span>',icon:'<i class="icon"></i>',badge:'<span class="badge"></span>',leftTreeHandle:'<div class="tree-left-handle"></div>',handleContractLeftTree:'<span class="left-tree-handle-btn handle-contract" title="收缩/展开"><i class="handle-icon fa fa-exchange"></i></span>',handleCollapseAll:'<span class="left-tree-handle-btn handle-collapse-all" title="一键折叠全部"><i class="handle-icon fa fa-compress"></i></span>',handleExpandAll:'<span class="left-tree-handle-btn handle-expand-all" title="一键展开全部"><i class="handle-icon fa fa-expand"></i></span>',treeSearch:'<div class="tree-search"><input type="text" class="tree-search-input" placeholder="search" /></div>',collapseAllHandle:'<div class="collapse-all-handle"><span class="collapse-all-handle-btn collapsed" title="一键折叠/展开全部"><i class="handle-icon fa fa-compress"></i></span></div>'},l.prototype.getOptions=function(t){return this.handleToStandardOption(t)},l.prototype.handleToStandardOption=function(t){var e=this.getDefaults();return(t=I.extend({},e,this.$element.data(),t)).changeUrlAnchor||(t.treeOption.option.enableLink=!1),t},l.prototype.refreshOption=function(t){return this.options=I.extend(!0,{},this.options,t),this.getOptions(this.options),this.destroy(),this.init(),this},l.prototype.destroy=function(){return this.$element.html(this.$el_.html()),this},l.prototype.getDefaults=function(){return l.DEFAULTS},I.fn[i]=function(a,n){var o=s;return this.each(function(){var t=I(this),e=I.data(this,i);"string"==typeof a?e?I.isFunction(e[a])&&"_"!==a.charAt(0)?("destroy"===a&&t.removeData(i),n instanceof Array||(n=[n]),o=e[a].apply(e,n)):r("No such method : "+a):r("Not initialized, can not call method : "+a):"boolean"==typeof a?o=e:I.data(this,i,new l(this,I.extend(!0,{},a)))}),o||this}}(jQuery,window,document);
//# sourceMappingURL=autoCatalog.js.map