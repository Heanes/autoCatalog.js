/*
 * autoCatalog - v1.0.0 - 2018-12-10 17:16:07 Monday
 * https://github.com/heanes/autoCatalog.js
 * Copyright (c) 2018 Heanes
 * Licensed MIT License
 */

"use strict";!function(D,I,t,h){var s="autoCatalog",e={outlineSelector:["h2","h3","h4"],catalogContainer:h,autoCounter:!1,showChapterNumber:!0,showChapterSymbol:!0,formatChapterAnchor:h,changeUrlAnchor:!0,scrollContentAnimationDelay:400,scrollToContentOffset:0,scrollCatalogAnimationDelay:400,useButtonToScroll:!1,clickToScrollCatalogStep:48,alwaysShow:!0,collapseOnInit:!1,dataChapterFieldName:"data-chapter",onChapterClick:h,treeOption:{option:{data:[],getDataUrl:"",nodeIcon:"fa fa-list",iconCollapse:"",iconExpand:"",iconEmpty:"icon-empty",showCollapseExpandIcon:!1,showIcon:!1,nodeDefaultState:{selected:!1,expanded:!0,disabled:!1,checked:!1},afterRenderNode:function(t,e){},enableLink:!0,showSingleNodeIcon:!0},node:{text:"",nodeIcon:"fa fa-list",href:"",iconSelected:"",selectable:!0,state:{selected:!1,expanded:!0,disabled:!1,checked:!1},switchToShow:!0,target:"",nodes:[]}}},i=function(t,e){return this._defaults=this.getDefaults(),this.options=null,this.$element=null,this.inState=null,this.init(t,e),{options:this.options,init:D.proxy(this.init,this),destroy:D.proxy(this.destroy,this),refreshOption:D.proxy(this.refreshOption,this),show:D.proxy(this.show,this),hide:D.proxy(this.hide,this),toggle:D.proxy(this.toggle,this)}};function l(t){I.console&&I.console.error(t)}i.V=i.VERSION="1.0.0",i.DEFAULTS=e,i.prototype.init=function(t,e){return this.$element=D(t),this.$el_=this.$element.clone(!0),this.options=this.getOptions(e),this.treeData=this.getChapterTreeData(),this.renderCatalog(this.treeData),this.bindEvent(),this},i.prototype.bindEvent=function(){var t=this.$element,e=this.$catalog,i=this.options,a=t.position(),o=t.height(),l=this,n=e.find(".catalog-list-wrap"),s=e.find(".catalog-list"),r=e.find(".node-wrap"),d=r.eq(0).height(),c=e.find(".scrollbar-location-arrow"),p=c.height(),h=this.$outlines,f=h.length,u=n.height(),g=s.height()-u,v=e.find(".go-up-btn"),m=e.find(".go-down-btn"),C=i.clickToScrollCatalogStep,b=i.scrollCatalogAnimationDelay,y=i.scrollContentAnimationDelay,T=0,w=0,x=void 0,S=void 0,A=void 0,N=void 0,O=0;D(I).on("scroll",function(){O=D(this).scrollTop();for(var t=f-1;0<t;t--){if(x=h.eq(t),O>=x.offset().top-d)return N=x.attr(i.dataChapterFieldName),S=s.find("["+i.dataChapterFieldName+'="'+N+'"]'),A=S.position(),r.removeClass("active"),S.addClass("active"),0<g&&(A.top+d<=u?(T=0,v.addClass("disabled"),m.removeClass("disabled")):A.top+d>u&&A.top<g?(T=-A.top+u/2-d,v.removeClass("disabled"),m.removeClass("disabled")):A.top>g&&(T=-g,v.removeClass("disabled"),m.addClass("disabled")),i.useButtonToScroll?0<b?s.stop().animate({top:T},b):s.css({top:T}):0<b?n.stop().animate({scrollTop:-T},b):n.scrollTop(-T)),w=A.top+(S.height()-p)/2,0<b?c.stop().animate({top:w},b):c.css({top:w}),!1;w=(d-p)/2,0<b?c.stop().animate({top:w},b):c.css({top:w}),r.removeClass("active").eq(0).addClass("active")}i.alwaysShow||(O>=a.top+o?e.animate({opacity:0,visibility:"hidden"},1e3):e.animate({opacity:1,visibility:"visible"},1e3))}),(!i.changeUrlAnchor||0<i.scrollToContentOffset)&&e.on("click",function(t){var e=D("html,body"),a=D(t.target),o=a.hasClass("node-wrap")?a:a.closest(".node-wrap");if(i.changeUrlAnchor)I.location.href=I.location.href.split("#")[0]+o.attr("href");else{var n=o.attr(i.dataChapterFieldName),s=l.$element.find("["+i.dataChapterFieldName+'="'+n+'"]');0<y?e.animate({scrollTop:s.offset().top+i.scrollToContentOffset},y):e.scrollTop(s.offset().top+i.scrollToContentOffset)}return!1}),i.useButtonToScroll?(v.on("click",function(){var t=D(this);return t.hasClass("disabled")||(Math.abs(parseInt(s.css("top")))>=C?(s.stop().animate({top:"+="+C},"fast"),m.removeClass("disabled")):(s.stop().animate({top:"0"},"fast"),t.addClass("disabled"))),!1}),m.on("click",function(){var t=D(this);return t.hasClass("disabled")||(g-Math.abs(parseInt(s.css("top")))>=C?(e.find(".catalog-list").stop().animate({top:"-="+C},"fast"),v.removeClass("disabled")):(s.stop().animate({top:-g},"fast"),t.addClass("disabled"))),!1})):(n.addClass("auto-scroll"),e.find(".catalog-scrollbar-right").remove());var $=e.find(".go-top-btn"),L=e.find(".toggle-show-btn");return $.on("click",function(){D("html,body").animate({scrollTop:a.top},"fast")}),L.on("click",function(){l.$catalog.toggleClass("collapse")}),D(I).trigger("scroll"),this},i.prototype.getChapterTreeData=function(t){var e=t||this.$element,i=this.options,l=i.outlineSelector,a=l.join(","),o=e.find(a);this.$outlines=o;var r=[],d=this;return D.each(o,function(t,e){var a=D(e),o={nodes:[]};o.text=a.text();var n=d.matchOutlineSelectorLevel(a,l);if(1===(o.level=n))o.outline=[r.length+1],o.href="#"+d.formatChapterAnchor(o),r.push(o);else{var s=d.getParentNodeByLevel(r,n);o.outline=s.outline,o.href="#"+d.formatChapterAnchor(o),s.parentNode.nodes.push(o)}d.insertChapterAnchorToContent(a,o),a.attr(i.dataChapterFieldName,o.outline.join("."))}),r},i.prototype.getParentNodeByLevel=function(t,e){if(1===e)return t;var a=t[t.length-1],o=[];if(2===e)return{parentNode:a,outline:o=[t.length,a.nodes.length+1]};o=[t.length,a.nodes.length];for(var n=2;n<e;n++){var s=a.nodes;a=s[1<s.length?s.length-1:0],o.push(a.nodes.length+1)}return{parentNode:a,outline:o}},i.prototype.formatChapterAnchor=function(t,e){var a=this.options.formatChapterAnchor;return"function"==typeof a?a(t):(e=e||".",t.outline.join(e)+e+t.text)},i.prototype.matchOutlineSelectorLevel=function(a,t){var e=this.options;t=t||e.outlineSelector;var o=1;return D.each(t,function(t,e){if(a.hasClass(e)||a[0].tagName.toLowerCase()===e.toLowerCase())return o=t+1,!1}),o},i.prototype.insertChapterAnchorToContent=function(t,e){var a=this.generateOutlineAnchor(e);return t.before(a),this},i.prototype.generateOutlineAnchor=function(t){return'<div class="auto-catalog-outline-anchor">\n            <a class="auto-catalog-anchor-href" name="'+this.formatChapterAnchor(t)+'"></a>\n        </div>'},i.prototype.renderCatalog=function(t){var e=this.options;this.$catalog=D(this.template.main);var a=e.catalogContainer;!e.catalogContainer instanceof jQuery&&(a=D(e.catalogContainer));var o=this.$catalog.find(".catalog-list");return a.empty().append(this.$catalog),this.convertToStandardTree(t),o.append(this.buildTree(t)),e.collapseOnInit&&this.$catalog.addClass("collapse"),this.$catalog.find(".catalog-list-wrap").height()>=this.$catalog.find(".catalog-list").height()&&this.$catalog.find(".catalog-scrollbar-right").hide(),this},i.prototype.template={main:'<div class="auto-catalog">\n            <div class="catalog-wrap">\n                <div class="catalog-scrollbar-left">\n                    <em class="circle start"></em>\n                    <em class="circle end"></em>\n                </div>\n                <div class="catalog-list-wrap">\n                    <div class="catalog-list tree-list">\n                        <div class="scrollbar-location-arrow">\n                            <i class="rectangle"></i>\n                            <i class="triangle-right"></i>\n                        </div>\n                    </div>\n                </div>\n                <div class="catalog-scrollbar-right">\n                    <a class="handle-btn go-up-btn disabled" href="javascript:;"><i class="triangle-up"></i></a>\n                    <a class="handle-btn go-down-btn" href="javascript:;"><i class="triangle-down"></i></a>\n                </div>\n            </div>\n            <div class="catalog-toolbar-wrap">\n                <div class="catalog-toolbar">\n                    <a class="handle-btn toggle-show-btn" href="javascript:;"><i class="fa fa-list"></i></a>\n                    <a class="handle-btn go-top-btn" href="javascript:;"><i class="fa fa-angle-up"></i></a>\n                </div>\n            </div>\n        </div>',chapterSymbol:'<em class="chapter-symbol"></em>'},i.prototype.buildTree=function(t,l,e){if(t){var r=this.options,d=this.options.treeOption.option;l=l===h?1:l;var c=this,p=D(c.treeTemplate.treeListGroup);return D.each(t,function(t,e){var a=D(c.treeTemplate.node).attr("data-nodeId",e.nodeId),o=D(c.treeTemplate.nodeWrap);d.enableLink&&((o=D(c.treeTemplate.nodeLink)).attr("href",e.href),e.target!==h&&o.attr("target",e.target));for(var n=0;n<l-1;n++)o.append(c.treeTemplate.indent);r.showChapterSymbol&&o.append('<em class="chapter-symbol"></em>');var s=[];if(e.nodes&&0<e.nodes.length?(s.push("node-collapse-expand-icon"),e.state.expanded?(s.push("expand"),s.push(d.iconExpand),a.addClass("expand")):(s.push("collapse"),s.push(d.iconCollapse),a.addClass("collapse"))):s.push(d.iconEmpty),d.showCollapseExpandIcon&&o.append(D(c.treeTemplate.icon).addClass(s.join(" "))),d.showIcon&&(1===l||d.showSingleNodeIcon||e.nodes&&0<e.nodes.length)){var i=["node-icon"];i.push(e.nodeIcon||d.nodeIcon),o.append(D(c.treeTemplate.icon).addClass(i.join(" ")))}if(r.showChapterNumber&&o.addClass("chapter-item").append('<span class="chapter-number">'+e.outline.join(".")+".</span>"),o.append(D(c.treeTemplate.nodeText).append(e.text).addClass("chapter-text")),o.attr(r.dataChapterFieldName,e.outline.join(".")),p.append(a.append(o)),d.afterRenderNode&&"function"==typeof d.afterRenderNode&&d.afterRenderNode(a,l),a.addClass("level"+l),e.nodes&&0<e.nodes.length&&a.append(c.buildTree(e.nodes,l+1)),1===l)return p}),p}},i.prototype.convertToStandardTree=function(a){if(a){var o=this.options,n=o.treeOption.node,s=this;return D.each(a,function(t,e){e.state=D.extend(!0,{},n.state,o.nodeDefaultState,e.state),a[t]=D.extend(!0,{},n,e),e.nodes&&0<e.nodes.length&&(a[t].nodes=s.convertToStandardTree(e.nodes))}),a}},i.prototype.treeTemplate={treeTopWrap:'<div class="tree-top-wrap"></div>',treeTop:'<ul class="tree-top-list"></ul>',treeListWrap:'<div class="tree-list-wrap"></div>',treeList:'<div class="tree-list"></div>',treeListGroupWrap:'<div class="tree-group-wrap"></div>',treeListGroup:'<ul class="tree-group"></ul>',nodeWrap:'<span class="node-wrap"></span>',nodeLink:'<a class="node-wrap"></a>',node:'<li class="tree-node"></li>',link:'<a href="javascript:;" class="node-wrap"></a>',nodeText:'<span class="node-text"></span>',indent:'<span class="indent"></span>',icon:'<i class="icon"></i>',badge:'<span class="badge"></span>',leftTreeHandle:'<div class="tree-left-handle"></div>',handleContractLeftTree:'<span class="left-tree-handle-btn handle-contract" title="收缩/展开"><i class="handle-icon fa fa-exchange"></i></span>',handleCollapseAll:'<span class="left-tree-handle-btn handle-collapse-all" title="一键折叠全部"><i class="handle-icon fa fa-compress"></i></span>',handleExpandAll:'<span class="left-tree-handle-btn handle-expand-all" title="一键展开全部"><i class="handle-icon fa fa-expand"></i></span>',treeSearch:'<div class="tree-search"><input type="text" class="tree-search-input" placeholder="search" /></div>',collapseAllHandle:'<div class="collapse-all-handle"><span class="collapse-all-handle-btn collapsed" title="一键折叠/展开全部"><i class="handle-icon fa fa-compress"></i></span></div>'},i.prototype.getOptions=function(t){return this.handleToStandardOption(t)},i.prototype.handleToStandardOption=function(t){var e=this.getDefaults();return(t=D.extend({},e,this.$element.data(),t)).changeUrlAnchor||(t.treeOption.option.enableLink=!1),t},i.prototype.refreshOption=function(t){return this.options=D.extend(!0,{},this.options,t),this.getOptions(this.options),this.destroy(),this.init(),this},i.prototype.destroy=function(){return this.$element.html(this.$el_.html()),this},i.prototype.getDefaults=function(){return i.DEFAULTS},D.fn[s]=function(a,o){var n=h;return this.each(function(){var t=D(this),e=D.data(this,s);"string"==typeof a?e?D.isFunction(e[a])&&"_"!==a.charAt(0)?("destroy"===a&&t.removeData(s),o instanceof Array||(o=[o]),n=e[a].apply(e,o)):l("No such method : "+a):l("Not initialized, can not call method : "+a):"boolean"==typeof a?n=e:D.data(this,s,new i(this,D.extend(!0,{},a)))}),n||this}}(jQuery,window,document);
//# sourceMappingURL=autoCatalog.js.map